import t from"fs";import s from"path";var g=a=>{function S(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return S()+new Date().getTime().toString(16)},h=async({folderPath:a="."})=>(console.log("Checking local files...",a),t.existsSync(a)||(console.log("Root Folder not found.., created root folder.."),t.mkdirSync(a,{recursive:!0})),{async addItems(d,f){let l=s.join(a,`${f}`);t.existsSync(l)||(console.log("collection folder path created..."),t.mkdirSync(l,{recursive:!0}));let n=[],o=[],r=[];return d.forEach(e=>{e._id?o.push(e):r.push({...e,_id:g(),createdAt:new Date})}),o.length&&o.forEach(e=>{let i=s.join(l,`data-${e._id.substring(0,1)}.txt`);if(t.existsSync(i)){let u=t.readFileSync(i,"utf-8"),c=JSON.parse(u);c=c.filter(y=>y._id!==e._id),c.push(e),t.writeFileSync(i,JSON.stringify(c))}else t.writeFileSync(i,JSON.stringify([e]))}),r.length>0&&r.forEach(e=>{let i=s.join(l,`data-${e._id.substring(0,1)}.txt`);if(t.existsSync(i)){let u=t.readFileSync(i,"utf-8"),c=JSON.parse(u);c.push(e),t.writeFileSync(i,JSON.stringify(c))}else t.writeFileSync(i,JSON.stringify([e]))}),await this.getItems({},f)},async getItems(d,f){let l=s.join(a,`${f}`);if(!t.existsSync(l))return console.log("collection folder path not found..."),{items:[],error:null};let n=[],o=t.readdirSync(l);for(let r of o){let e=s.join(l,r),i=t.readFileSync(e,"utf-8");n=n.concat(JSON.parse(i))}return{items:n||[],error:null}},async deleteItems(d,f){let l=s.join(a,`${f}`);if(!t.existsSync(l))return console.log("collection folder path not found..."),{items:[],error:null};let n=[],o=t.readdirSync(l);for(let r of o){let e=s.join(l,r),i=t.readFileSync(e,"utf-8");n=n.concat(JSON.parse(i))}d.forEach(r=>{n=n.filter(e=>e._id!==r._id)});for(let r of o){let e=s.join(l,r);t.writeFileSync(e,JSON.stringify(n.filter(i=>i._id.startsWith(r.split(".")[0].split("-")[1]))))}return{items:n||[],error:null}}}),m={getDbManager:h};export{m as default};
